# HW14 Microservice and Kafka

## Main feature of Microservice

- **Decoupling**: Within a system, services are largely decoupled. The application as a whole can therefore be easily constructed, altered, and scalable
- **Componentization**: Microservices are viewed as independent components that can easily be exchanged or upgraded
- **Business Capabilities**: Microservices are relatively simple and only focus on one service
- **Team autonomy**: Each developer works independently of each other, allowing for a faster project timeline
- **Continuous Delivery**: Enables frequent software releases through systematic automation of software development, testing, and approval
- **Responsibility:** Microservices are not focused on applications as projects. Rather, they see applications as products they are responsible for
- **Decentralized Governance:** Choosing the right tool according to the job is the goal. Developers can choose the best tools to solve their problems
- **Agility:** Microservices facilitate agile development. It is possible to create new features quickly and discard them again at any time.

![image-20240209234520156](C:\Users\Hanyun\OneDrive\桌面\chuwa java batch\assignments\chuwa1206\ShortQuestions\typora_images\hw14\image-20240209234520156.png)



## How to do load balancing ?

where: 

- In between the client application/user and the server
- In between the server and the application/job servers
- In between the application servers and the cache servers
- In between the cache servers the database servers

usually use Nginx, Ribbon

api gateway can also do load balancing



## What are Resilience patterns? What is circuit breaker?

resilience patterns refer to the strategies and mechanisms implemented to ensure that an application remains responsive and robust in the face of failures and unexpected conditions. Typically it includes time out and circuit breaker. They can be achieved by Hystrix/Resilience4j.

Circuit breaker will stop calls comming into a failed service. It has three states, close(normal), open(stopped), and half open(recover attempt)



## How to do service discovery?

eureka（比较旧）， spring cloud consul， nacos（国内用）



## What are the major components of Kafka?

producer & consumer

broker

topic, partition

zookeeper (manage kafka brokers)



## What do you mean by a Partition in Kafka?

A unit of parallelism and scalability. Topic can be divided into multiple partitions



## What do you mean by zookeeper in Kafka and what are its uses?

- ZooKeeper is used for managing and coordinating Kafka brokers.
- It stores metadata about brokers, topics, and partitions.
- ZooKeeper is used for leader election, maintaining broker liveness, and managing partition reassignments.
- send notifications to Kafka in case of changes (new broker, broker die...)



## Can we use Kafka without Zookeeper?

Kafka Raft Metadata Mode is introduced in Kafka 2.8.0 and later versions. which aims to eliminate the dependency on ZooKeeper for Kafka metadata management. It is possible, but depend on whether your system and cooperation allows to.



## Explain the concept of Leader and Follower in Kafka.

In Kafka, each partition of a topic is replicated across multiple brokers for fault tolerance. Among these replicas, one broker is designated as the "Leader" for the partition, while the others are considered "Follower" replicas.

The Leader is responsible for handling all read and write requests for the partition. All producers and consumers interact with the Leader to produce and consume messages.

When a producer publishes a message to a partition, it is written to the Leader first. The Leader then replicates the message to the Follower replicas for durability.

If the Leader fails, one of the Follower replicas is automatically elected as the new Leader through a leader election process managed by ZooKeeper 



## Why is Topic Replication important in Kafka? What do you mean by ISR in Kafka?
Topic replication in Kafka is important for ensuring fault tolerance, data durability, and high availability. 

In-Sync Replicas (ISR) list refers to the set of Follower replicas that are fully caught up with the Leader replica's log.



## What do you understand about a consumer group in Kafka?

Consumer group allows multiple consumers to cconsume a set of topic parallelly. Each consumer group consumers partitions exclusively. And in the same consumer group, each consumer read from exclusive parititions. 

![image-20240209235620687](C:\Users\Hanyun\OneDrive\桌面\chuwa java batch\assignments\chuwa1206\ShortQuestions\typora_images\hw14\image-20240209235620687.png)



## How do you start a Kafka server?

Start zookeeper first, then Kafka



## Tell me about some of the real-world usages of Apache Kafka.

Async process: post image, high throughput where server need time to process

traffic shaping: when peak traffic



## Describe partitioning key in Kafka.

A partitioning key is a piece of metadata associated with each message that determines which partition of a topic the message will be assigned to. When a producer publishes a message to a Kafka topic, it includes a partitioning key along with the message payload.



## What is the purpose of partitions in Kafka?

scalability, parallelism, reliability



## Differentiate between Rabbitmq and Kafka.

Rabbitmq: centralized architecture, queueing + pub-sub, scale vertically

Kafka: distributed, pub-sub, scale horizontally



## What are the guarantees that Kafka provides?

high throughput, scalability, fault tolerance, and low latency, ordering guarantees within a partition and at-least-once message delivery semantics



## What do you mean by an unbalanced cluster in Kafka? How can you balance it?

e.g. uneven data distribution, uneven consumer workload, broker underutilization

resolutions: reassign partitions, adjust replication factor, scale out brokers, Optimize Consumer Group Assignment



## What is offset?
Offsets are used to track the position of a consumer within a partition's message log and enable consumers to consume messages in a sequential and incremental manner.